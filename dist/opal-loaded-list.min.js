!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("rionite"),require("cellx")):"function"==typeof define&&define.amd?define(["rionite","cellx"],e):"object"==typeof exports?exports["opal-loaded-list"]=e(require("rionite"),require("cellx")):t["opal-loaded-list"]=e(t.rionite,t.cellx)}(this,function(t,e){return function(t){function e(i){if(o[i])return o[i].exports;var l=o[i]={exports:{},id:i,loaded:!1};return t[i].call(l.exports,l,l.exports,e),l.loaded=!0,l.exports}var o={};return e.m=t,e.c=o,e.p="",e(0)}({0:function(t,e,o){"use strict";o(58);var i=o(2),l=i.Utils.mixin,n=i.cellx,a=o(1),s=a.getText,d=a.ComponentTemplate,r=a.Component;t.exports=r.extend("opal-loaded-list",{Static:{props:{dataprovider:{type:String,required:!0,readonly:!0},count:100,query:String,itemAs:{default:"$item",readonly:!0},preloading:{default:!1,readonly:!0}},i18n:{notFoundMessage:s.t("Ничего не найдено")},template:new d(o(31)),assets:{loader:{}}},_scrolling:!1,_loadingCheckTimeout:null,_requestCallback:null,_lastRequestedQuery:void 0,_lastAppliedQuery:void 0,initialize:function(){this.dataProvider=Function("return this."+this.props.dataprovider+";").call(this.ownerComponent||window),n.define(this,{list:n.list(),total:void 0,_loadingCheckPlanned:!1,loading:!1,empty:function(){return!this.list.length},notFoundShown:function(){return 0===this.total&&!this._loadingCheckPlanned&&!this.loading},loaderShown:function(){return void 0===this.total||this.list.length<this.total||this.loading}})},elementAttached:function(){this.listenTo(this.element,"scroll",this._onScroll),this.listenTo(this.props,"change:query",this._onQueryChange),this.props.preloading?this._load():this.checkLoading()},_onScroll:function(){var t=this;this._scrolling||(this._scrolling=!0,this._loadingCheckPlanned?this._loadingCheckTimeout.clear():this._loadingCheckPlanned=!0,this._loadingCheckTimeout=this.setTimeout(function(){t._loadingCheckPlanned=!1,t.checkLoading(),t._scrolling=!1},150))},_onQueryChange:function(){var t=this;this._loadingCheckPlanned?this._loadingCheckTimeout.clear():(this.loading&&(this._requestCallback.cancel(),this.loading=!1),this.list.clear(),this.total=void 0,this._loadingCheckPlanned=!0),this._loadingCheckTimeout=this.setTimeout(function(){t._loadingCheckPlanned=!1,t.checkLoading()},300)},checkLoading:function(){if(this.props.query!==this._lastRequestedQuery||!(this.loading||void 0!==this.total&&this.list.length==this.total)){var t=this.element.getBoundingClientRect();!t.height||t.bottom<this.assets.loader.element.getBoundingClientRect().top||this._load()}},_load:function(){var t=this;this.loading&&this._requestCallback.cancel();var e=this._lastRequestedQuery=this.props.query,o=this.dataProvider,i=o.getItems.length>=2,l=[e];i&&l.unshift(this.props.count,this.list.length?this.list.get(-1).value:null),this.loading=!0,o.getItems.apply(o,l).then(this._requestCallback=this.registerCallback(function(o){t.loading=!1;var l=o.items;t.total=i&&void 0!==o.total?o.total:l.length,e===t._lastAppliedQuery?t.list.addRange(l):(t.list.clear().addRange(l),t._lastAppliedQuery=e),setTimeout(function(){t.checkLoading()},1)}))},_getContentContext:function(t){return l(Object.create(this.props.context),t.props.context)}})},1:function(e,o){e.exports=t},2:function(t,o){t.exports=e},31:function(t,e){t.exports='{{block list }} <div class="opal-loaded-list__list"> {{block list_inner }} <template is="rt-repeat" for="{props.itemAs} of list" strip=""> <rt-content class="opal-loaded-list__list-item" get-context="_getContentContext"></rt-content> </template> {{/block}} </div> {{/block}} {{block loader }} <opal-loader class="opal-loaded-list__loader" shown="{loaderShown}" align-center="{empty}"></opal-loader> {{/block}} {{block not_found }} <div class="opal-loaded-list__not-found" shown="{notFoundShown}"><span class="opal-loaded-list__not-found-message">{{i18n.notFoundMessage}}</span></div> {{/block}}'},58:function(t,e){t.exports=function(t){var e=t.head||t.getElementsByTagName("head")[0];if(e){var o=t.createElement("style");return o.type="text/css",o.textContent=".opal-loaded-list{position:relative;display:block;overflow-x:hidden;overflow-y:auto;height:500px}.opal-loaded-list .opal-loaded-list__list-item{display:block}.opal-loaded-list .opal-loaded-list__loader[align-center]{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto}.opal-loaded-list .opal-loaded-list__not-found{display:none;box-sizing:border-box;padding:10px;width:100%;height:100%;text-align:center;white-space:nowrap}.opal-loaded-list .opal-loaded-list__not-found::before{display:inline-block;width:0;height:100%;content:'';vertical-align:middle}.opal-loaded-list .opal-loaded-list__not-found-message{display:inline-block;color:gray;vertical-align:middle}.opal-loaded-list .opal-loaded-list__not-found[shown]{display:inline-block}",e.appendChild(o),o}return null}(document)}})});
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("rionite"),require("cellx")):"function"==typeof define&&define.amd?define(["rionite","cellx"],e):"object"==typeof exports?exports["opal-loaded-list"]=e(require("rionite"),require("cellx")):t["opal-loaded-list"]=e(t.rionite,t.cellx)}(this,function(t,e){return function(t){function e(i){if(o[i])return o[i].exports;var n=o[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var o={};return e.m=t,e.c=o,e.p="",e(0)}({0:function(t,e,o){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),n=this&&this.__decorate||function(t,e,o,i){var n,l=arguments.length,a=l<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(a=(l<3?n(a):l>3?n(e,o,a):n(e,o))||a);return l>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(e,"__esModule",{value:!0}),o(56);var l=o(2),a=o(1),r=o(29),s=l.Utils.mixin,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._scrolling=!1,e}return i(e,t),e.prototype.initialize=function(){var t=Function("return this."+this.props.dataprovider+";").call(this.ownerComponent||window);if(!t)throw new TypeError("dataProvider is not defined");this.dataProvider=t,l.define(this,{list:new l.ObservableList,total:void 0,_loadingCheckPlanned:!1,loading:!1,empty:function(){return!this.list.length},notFoundShown:function(){return 0===this.total&&!this._loadingCheckPlanned&&!this.loading},loaderShown:function(){return void 0===this.total||this.list.length<this.total||this.loading}})},e.prototype.elementAttached=function(){this.props.preloading?this._load():this.checkLoading()},e.prototype.checkLoading=function(){if(this.props.query!==this._lastRequestedQuery||!(this.loading||void 0!==this.total&&this.list.length==this.total)){var t=this.element.getBoundingClientRect();!t.height||t.bottom<this.$("loader").element.getBoundingClientRect().top||this._load()}},e.prototype._load=function(){this.loading&&this._requestCallback.cancel();var t=this._lastRequestedQuery=this.props.query,e=this.dataProvider,o=e.getItems.length>=2,i=[t];o&&i.unshift(this.props.count,this.list.length?this.list.get(-1).value:void 0),this.loading=!0,e.getItems.apply(e,i).then(this._requestCallback=this.registerCallback(function(e){var i=this;this.loading=!1;var n=e.items;this.total=o&&void 0!==e.total?e.total:n.length,t===this._lastLoadedQuery?this.list.addRange(n):(this.list.clear().addRange(n),this._lastLoadedQuery=t),setTimeout(function(){i.checkLoading()},1),this.emit("loaded")}))},e.prototype._getContentContext=function(t){return s(Object.create(this.props.context),t.props.context)},e}(a.Component);d=n([a.d.Component({elementIs:"opal-loaded-list",props:{dataprovider:{type:String,required:!0,readonly:!0},count:100,query:String,itemAs:{default:"$item",readonly:!0},preloading:{default:!1,readonly:!0}},i18n:{notFoundMessage:a.getText.t("Ничего не найдено")},bemlTemplate:r,events:{":component":{"property-query-change":function(t){var e=this;t.target==this&&(this._loadingCheckPlanned?this._loadingCheckTimeout.clear():(this.loading&&(this._requestCallback.cancel(),this.loading=!1),this.list.clear(),this.total=void 0,this._loadingCheckPlanned=!0),this._loadingCheckTimeout=this.setTimeout(function(){e._scrolling=!1,e._loadingCheckPlanned=!1,e.checkLoading()},300))}},":element":{scroll:function(){var t=this;this._scrolling||(this._scrolling=!0,this._loadingCheckPlanned?this._loadingCheckTimeout.clear():this._loadingCheckPlanned=!0,this._loadingCheckTimeout=this.setTimeout(function(){t._scrolling=!1,t._loadingCheckPlanned=!1,t.checkLoading()},150))}}}})],d),e.default=d},1:function(e,o){e.exports=t},2:function(t,o){t.exports=e},29:function(t,e){t.exports="div/list {\ntemplate (is=rt-repeat, for={props.itemAs} of list) {\nrt-content/list-item (get-context=_getContentContext)\n}\n}\nopal-loader/loader (shown={loaderShown}, align-center={empty})\ndiv/not-found (shown={notFoundShown}) {\nspan/not-found-message { '{constructor.i18n.notFoundMessage}' }\n}"},56:function(t,e){t.exports=function(t){var e=t.head||t.getElementsByTagName("head")[0];if(e){var o=t.createElement("style");return o.type="text/css",o.textContent=".opal-loaded-list{position:relative;display:block;overflow-x:hidden;overflow-y:auto;height:500px}.opal-loaded-list .opal-loaded-list__list-item{display:block}.opal-loaded-list .opal-loaded-list__loader[align-center]{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto}.opal-loaded-list .opal-loaded-list__not-found{display:none;box-sizing:border-box;padding:10px;width:100%;height:100%;text-align:center;white-space:nowrap}.opal-loaded-list .opal-loaded-list__not-found::before{display:inline-block;width:0;height:100%;content:'';vertical-align:middle}.opal-loaded-list .opal-loaded-list__not-found-message{display:inline-block;color:gray;vertical-align:middle}.opal-loaded-list .opal-loaded-list__not-found[shown]{display:inline-block}",e.appendChild(o),o}return null}(document)}})});
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("rionite"),require("cellx")):"function"==typeof define&&define.amd?define(["rionite","cellx"],e):"object"==typeof exports?exports["opal-loaded-list"]=e(require("rionite"),require("cellx")):t["opal-loaded-list"]=e(t.rionite,t.cellx)}(this,function(t,e){return function(t){function e(n){if(o[n])return o[n].exports;var i=o[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var o={};return e.m=t,e.c=o,e.p="",e(0)}({0:function(t,e,o){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(t,e,o,n){var i,l=arguments.length,a=l<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(l<3?i(a):l>3?i(e,o,a):i(e,o))||a);return l>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(e,"__esModule",{value:!0}),o(57);var l=o(2),a=o(1),s=o(29),r=l.Utils.mixin,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._scrolling=!1,e}return n(e,t),e.prototype.initialize=function(){this.dataProvider=this.props.dataprovider,l.define(this,{list:new l.ObservableList,total:void 0,_loadingCheckPlanned:!1,loading:!1,empty:function(){return!this.list.length},notFoundShown:function(){return 0===this.total&&!this._loadingCheckPlanned&&!this.loading},loaderShown:function(){return void 0===this.total||this.list.length<this.total||this.loading}})},e.prototype.elementAttached=function(){this.props.preloading?this._load():this.checkLoading()},e.prototype.checkLoading=function(){if(this.props.query!==this._lastRequestedQuery||!(this.loading||void 0!==this.total&&this.list.length==this.total)){var t=this.element.getBoundingClientRect();!t.height||t.bottom<this.$("loader").element.getBoundingClientRect().top||this._load()}},e.prototype._load=function(){this.loading&&this._requestCallback.cancel();var t=this._lastRequestedQuery=this.props.query,e=this.dataProvider,o=e.getItems.length>=2,n=[t];o&&n.unshift(this.props.count,this.list.length?this.list.get(-1).value:void 0),this.loading=!0,e.getItems.apply(e,n).then(this._requestCallback=this.registerCallback(function(e){var n=this;this.loading=!1;var i=e.items;this.total=o&&void 0!==e.total?e.total:i.length,t===this._lastLoadedQuery?this.list.addRange(i):(this.list.clear().addRange(i),this._lastLoadedQuery=t),l.Cell.forceRelease(),this.emit("loaded"),setTimeout(function(){n.checkLoading()},1)}))},e.prototype._getContentContext=function(t){return r(Object.create(this.props.context),t.props.context)},e}(a.Component);d=i([a.d.Component({elementIs:"opal-loaded-list",props:{dataprovider:{type:Object,required:!0,readonly:!0},count:100,query:String,itemAs:{default:"$item",readonly:!0},preloading:{default:!1,readonly:!0}},i18n:{notFound:a.getText.t("Ничего не найдено")},bemlTemplate:s,events:{":component":{"property-query-change":function(){var t=this;this._loadingCheckPlanned?this._loadingCheckTimeout.clear():(this.loading&&(this._requestCallback.cancel(),this.loading=!1),this.list.clear(),this.total=void 0,this._loadingCheckPlanned=!0),this._loadingCheckTimeout=this.setTimeout(function(){t._scrolling=!1,t._loadingCheckPlanned=!1,t.checkLoading()},300)}},":element":{scroll:function(){var t=this;this._scrolling||(this._scrolling=!0,this._loadingCheckPlanned?this._loadingCheckTimeout.clear():this._loadingCheckPlanned=!0,this._loadingCheckTimeout=this.setTimeout(function(){t._scrolling=!1,t._loadingCheckPlanned=!1,t.checkLoading()},150))}}}})],d),e.default=d},1:function(e,o){e.exports=t},2:function(t,o){t.exports=e},29:function(t,e){t.exports="@section/inner {\ndiv/list {\n@repeat (for={props.itemAs} of list) {\nrt-content/list-item (get-context=_getContentContext)\n}\n}\nopal-loader/loader (shown={loaderShown}, align-center={empty})\ndiv/not-found (shown={notFoundShown}) {\nspan/not-found-message { '{constructor.i18n.notFound}' }\n}\n}"},57:function(t,e){t.exports=function(t){var e=t.head||t.getElementsByTagName("head")[0];if(e){var o=t.createElement("style");return o.type="text/css",o.textContent=".opal-loaded-list{position:relative;display:block;overflow-x:hidden;overflow-y:auto;height:500px}.opal-loaded-list .opal-loaded-list__list-item{display:block}.opal-loaded-list .opal-loaded-list__loader[align-center]{position:absolute;top:0;right:0;bottom:0;left:0;margin:auto}.opal-loaded-list .opal-loaded-list__not-found{display:none;box-sizing:border-box;padding:10px;width:100%;height:100%;text-align:center;white-space:nowrap}.opal-loaded-list .opal-loaded-list__not-found::before{display:inline-block;width:0;height:100%;content:'';vertical-align:middle}.opal-loaded-list .opal-loaded-list__not-found-message{display:inline-block;vertical-align:middle;opacity:.6}.opal-loaded-list .opal-loaded-list__not-found[shown]{display:block}",e.appendChild(o),o}return null}(document)}})});
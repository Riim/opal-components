!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("cellx"),require("rionite")):"function"==typeof define&&define.amd?define(["cellx","rionite"],e):"object"==typeof exports?exports["opal-input-mask"]=e(require("cellx"),require("rionite")):t["opal-input-mask"]=e(t.cellx,t.rionite)}(this,function(t,e){return function(t){function e(i){if(n[i])return n[i].exports;var s=n[i]={exports:{},id:i,loaded:!1};return t[i].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";n(20),n(22);var i=n(2),s=n(3),r=s.Component,o=n(23),u=Array.prototype.forEach,a="_",f=/iphone/i.test(navigator.userAgent);t.exports=r.extend("opal-input-mask",{Static:{defaultDefinitions:o,props:{mask:String,placeholder:a},template:n(24)},_focusText:void 0,initialize:function(){if(!this.props.mask)throw new TypeError('Property "mask" is required');this._definitions=Object.create(this.constructor.defaultDefinitions),this._placeholder=this.props.placeholder.charAt(0)||a},ready:function(){this.assets.input=this.$("&__input").assets.control;var t=this._definitions;u.call(this.element.querySelectorAll("opal-input-mask-definition"),function(e){var n=e.$c.props;t[n.maskChar]=n.regex}),i.define(this,{_mask:function(){return this.props.mask.split("").filter(function(t){return"?"!=t})},_partialIndex:function(){var t=this.props.mask,e=t.indexOf("?");return e==-1?t.length:e},_tests:function(){return this._mask.map(function(e){return t[e]||null})},_firstTestIndex:function(){return this._tests.findIndex(function(t){return t})}});var e=this._placeholder;this._buffer=this._mask.map(function(n){return t[n]?e:n})},elementAttached:function(){this.listenTo(this.assets.input,{focusin:this._onInputFocusIn,focusout:this._onInputFocusOut,keydown:this._onInputKeyDown,keypress:this._onInputKeyPress,input:this._onInputInput}),this._checkValue()},_onInputFocusIn:function(){var t=this;this._focusText=this.assets.input.value;var e=this._checkValue();this._writeBuffer(),setTimeout(function(){e==t._buffer.length?t._setInputSelection(0,e):t._setInputSelection(e)},1)},_onInputFocusOut:function(){this._checkValue();var t=this.assets.input;t.value!=this._focusText&&this.emit("change")},_onInputKeyDown:function(t){var e=this.assets.input,n=t.which;if(8==n||46==n||f&&127==n){t.preventDefault();var i=e.selectionStart,s=e.selectionEnd;i==s&&(i=46!=n?this._prevTestIndex(i):s=this._nextTestIndex(i-1),s=46==n?this._nextTestIndex(s):s),this._clearBuffer(i,s),this._shiftLeft(i,s-1)}else 27==n&&(t.preventDefault(),e.value=this._focusText,this._setInputSelection(0,this._checkValue()))},_onInputKeyPress:function(t){var e=this._tests,n=this._buffer.length,i=this.assets.input,s=i.selectionStart,r=i.selectionEnd,o=t.which;if(!(t.ctrlKey||t.altKey||t.metaKey||o<32)&&o){t.preventDefault(),s!=r&&(this._clearBuffer(s,r),this._shiftLeft(s,r-1));var u=this._nextTestIndex(s-1);if(u<n){var a=String.fromCharCode(o);e[u].test(a)&&(this._shiftRight(u),this._buffer[u]=a,this._writeBuffer(),u=this._nextTestIndex(u),this._setInputSelection(u,u),u>=n&&this.emit("complete"))}}},_onInputInput:function(){var t=this;setTimeout(function(){t._setInputSelection(t._checkValue(!0))},1)},_checkValue:function(t){for(var e=this._partialIndex,n=this._placeholder,i=this._tests,s=this._buffer,r=s.length,o=this.assets.input,u=o.value,a=u.length,f=0,h=-1,c=0;f<r;f++)if(i[f]){for(s[f]=n;c++<a;){var l=u.charAt(c-1);if(i[f].test(l)){s[f]=l,h=f;break}}if(c>a){this._clearBuffer(f+1,r);break}}else s[f]==u.charAt(c)&&c++,f<e&&(h=f);return t?this._writeBuffer():h+1<e?(o.value="",this._clearBuffer(0,r)):o.value=s.slice(0,h+1).join(""),e?f:this._firstTestIndex},_shiftLeft:function(t,e){if(!(t<0)){for(var n=this._placeholder,i=this._tests,s=this._buffer,r=t,o=this._nextTestIndex(e),u=s.length;r<u;r++){var a=i[r];if(a){if(!(o<u&&a.test(s[o])))break;s[r]=s[o],s[o]=n,o=this._nextTestIndex(o)}}this._writeBuffer(),this._setInputSelection(Math.max(this._firstTestIndex,t))}},_shiftRight:function(t){for(var e=this._tests,n=this._buffer,i=this._placeholder,s=t,r=n.length;s<r;s++)if(e[s]){var o=this._nextTestIndex(s),u=n[s];if(n[s]=i,!(o<r&&e[o].test(u)))break;i=u}},_nextTestIndex:function(t){for(var e=this._tests,n=e.length;++t<n&&!e[t];);return t},_prevTestIndex:function(t){for(var e=this._tests;--t>=0&&!e[t];);return t},_writeBuffer:function(){this.assets.input.value=this._buffer.join("")},_clearBuffer:function(t,e){var n=this._placeholder,i=this._tests,s=this._buffer;e>s.length&&(e=s.length);for(var r=t;r<e;r++)i[r]&&(s[r]=n)},_setInputSelection:function(t){var e=arguments.length<=1||void 0===arguments[1]?t:arguments[1];this.assets.input.setSelectionRange(t,e)}})},,function(e,n){e.exports=t},function(t,n){t.exports=e},,,,,,,,,,,,,,,,,function(t,e,n){"use strict";n(21);var i=n(3),s=i.Component;t.exports=s.extend("opal-input-mask-definition",{Static:{props:{maskChar:String,regex:Object}}})},function(t,e){t.exports=function(t){var e=t.head||t.getElementsByTagName("head")[0];if(e){var n=t.createElement("style");return n.type="text/css",n.textContent=".opal-input-mask-definition{display:none}",e.appendChild(n),n}return null}(document)},function(t,e){t.exports=function(t){var e=t.head||t.getElementsByTagName("head")[0];if(e){var n=t.createElement("style");return n.type="text/css",n.textContent=".opal-input-mask .opal-input-mask__input .opal-text-input__control{font-family:'Lucida Console',Monaco,monospace}",e.appendChild(n),n}return null}(document)},function(t,e){"use strict";var n=t.exports=Object.create(null);n[9]=/\d/,n.z=/[a-zA-Z]/,n["*"]=/[0-9a-zA-Z]/},function(t,e){t.exports='<rt-content class="opal-input-mask__content"></rt-content>'}])});
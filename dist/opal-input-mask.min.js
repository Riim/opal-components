!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("rionite"),require("cellx")):"function"==typeof define&&define.amd?define(["rionite","cellx"],e):"object"==typeof exports?exports["opal-input-mask"]=e(require("rionite"),require("cellx")):t["opal-input-mask"]=e(t.rionite,t.cellx)}(this,function(t,e){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}({0:function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var l=t.length-1;l>=0;l--)(r=t[l])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=n(1),l=n(5),u=n(4),f=n(5);e.OpalInputMaskDefinition=f.default;var a=n(4);e.defaultDefinitions=a.default;var c=o.Utils.nextTick,p=Array.prototype.forEach,h=/iphone/i.test(navigator.userAgent),_=d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.initialize=function(){this._definitions=Object.create(this.constructor.defaultDefinitions)},e.prototype.ready=function(){this._textField=this.$("text-input").$("text-field");var t=this._definitions;p.call(this.element.querySelectorAll("opal-input-mask-definition"),function(e){var n=e.$c.props;t[n.maskChar]=n.regex}),o.define(this,{_mask:function(){return this.props.mask.split("").filter(function(t){return"?"!=t})},_partialIndex:function(){var t=this.props.mask,e=t.indexOf("?");return-1==e?t.length:e},_tests:function(){return this._mask.map(function(e){return t[e]||null})},_firstTestIndex:function(){return this._tests.findIndex(function(t){return t})}}),this._initBuffer()},e.prototype.elementAttached=function(){this.listenTo(this,"change:_mask",this._onMaskChange),this.listenTo(this._textField,{focus:this._onTextFieldFocus,blur:this._onTextFieldBlur,keydown:this._onTextFieldKeyDown,keypress:this._onTextFieldKeyPress,input:this._onTextFieldInput}),this._checkValue(!1)},e.prototype._onMaskChange=function(){var t=this;this._initBuffer(),o.Cell.afterRelease(function(){t._checkValue(!1)})},e.prototype._onTextFieldFocus=function(){var t=this;c(function(){document.activeElement==t._textField&&(t._setTextFieldSelection(0,t._checkValue(!1)),t._textAtFocusing=t._textField.value,t._writeBuffer())})},e.prototype._onTextFieldBlur=function(){this._checkValue(!1),this._textField.value!=this._textAtFocusing&&this.$("text-input").emit("change")},e.prototype._onTextFieldKeyDown=function(t){var e=this._textField,n=t.which;if(8==n||46==n||h&&127==n){t.preventDefault();var i=e.selectionStart,r=e.selectionEnd;i==r&&(46==n?(i=this._nextTestIndex(i-1),r=this._nextTestIndex(i)):i=this._prevTestIndex(i));var o=e.value;if(this._clearBuffer(i,r),this._shiftLeft(i,r-1),o!=e.value){var s=this.$("text-input");s.constructor.events["text-field"].input.call(s,t)}}else if(27==n&&(t.preventDefault(),e.value!=this._textAtFocusing)){e.value=this._textAtFocusing,this._setTextFieldSelection(0,this._checkValue(!1));var s=this.$("text-input");s.constructor.events["text-field"].input.call(s,t)}},e.prototype._onTextFieldKeyPress=function(t){var e=this._tests,n=this._buffer.length,i=this._textField,r=i.selectionStart,o=i.selectionEnd,s=t.which;if(!(t.ctrlKey||t.altKey||t.metaKey||s<32)&&s){t.preventDefault(),r!=o&&(this._clearBuffer(r,o),this._shiftLeft(r,o-1));var l=this._nextTestIndex(r-1);if(l<n){var u=String.fromCharCode(s);if(e[l].test(u)){this._shiftRight(l),this._buffer[l]=u,this._writeBuffer(),l=this._nextTestIndex(l),this._setTextFieldSelection(l,l);var f=this.$("text-input");f.constructor.events["text-field"].input.call(f,t),l>=n&&this.emit("complete")}else if(r!=o){var f=this.$("text-input");f.constructor.events["text-field"].input.call(f,t)}}}},e.prototype._onTextFieldInput=function(){this._setTextFieldSelection(this._checkValue(!0))},e.prototype._initBuffer=function(){var t=this._definitions;this._buffer=this._mask.map(function(e){return t[e]?null:e})},e.prototype._checkValue=function(t){for(var e=this._partialIndex,n=this._tests,i=this._buffer,r=i.length,s=this._textField.value,l=s.length,u=0,f=-1,a=0;u<r;u++)if(n[u]){for(i[u]=null;a++<l;){var c=s.charAt(a-1);if(n[u].test(c)){i[u]=c,f=u;break}}if(a>l){this._clearBuffer(u+1,r);break}}else i[u]==s.charAt(a)&&a++,u<e&&(f=u);return t?this._writeBuffer():(f+1<e?(this._clearBuffer(0,r),this.$("text-input").value=""):this.$("text-input").value=i.slice(0,f+1).join(""),o.Cell.forceRelease()),u},e.prototype._shiftLeft=function(t,e){if(!(t<0)){for(var n=this._tests,i=this._buffer,r=t,o=this._nextTestIndex(e),s=i.length;r<s;r++){var l=n[r];if(l){var u=void 0;if(!(o<s&&(u=i[o])&&l.test(u)))break;i[r]=u,i[o]=null,o=this._nextTestIndex(o)}}this._writeBuffer(),this._setTextFieldSelection(Math.max(this._firstTestIndex,t))}},e.prototype._shiftRight=function(t){for(var e=this._tests,n=this._buffer,i=null,r=n.length;t<r;t++)if(e[t]){var o=n[t];n[t]=i;var s=this._nextTestIndex(t);if(!(s<r&&o&&e[s].test(o)))break;i=o}},e.prototype._nextTestIndex=function(t){for(var e=this._tests,n=e.length;++t<n&&!e[t];);return t},e.prototype._prevTestIndex=function(t){for(var e=this._tests;--t>=0&&!e[t];);return t},e.prototype._writeBuffer=function(){var t=this._buffer,e=t.indexOf(null);this.$("text-input").value=(-1==e?t:t.slice(0,e)).join(""),o.Cell.forceRelease()},e.prototype._clearBuffer=function(t,e){var n=this._tests,i=this._buffer;e>i.length&&(e=i.length);for(var r=t;r<e;r++)n[r]&&(i[r]=null)},e.prototype._setTextFieldSelection=function(t,e){void 0===e&&(e=t),this._textField.setSelectionRange(t,e)},e}(s.Component);_.OpalInputMaskDefinition=l.default,_.defaultDefinitions=u.default,_=d=r([s.d.Component({elementIs:"opal-input-mask",props:{mask:{type:String,required:!0}},bemlTemplate:"@section/inner { rt-content/content (cloning=no) }"})],_),e.default=_;var d},1:function(e,n){e.exports=t},2:function(t,n){t.exports=e},4:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=Object.create(null);n[9]=/\d/,n.z=/[a-zA-Z]/,n["*"]=/[0-9a-zA-Z]/,e.default=n},5:function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var l=t.length-1;l>=0;l--)(r=t[l])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(e,"__esModule",{value:!0}),n(54);var o=n(1),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e}(o.Component);s=r([o.d.Component({elementIs:"opal-input-mask-definition",props:{maskChar:{type:String,required:!0,readonly:!0},regex:{type:eval,required:!0,readonly:!0}}})],s),e.default=s},54:function(t,e){t.exports=function(t){var e=t.head||t.getElementsByTagName("head")[0];if(e){var n=t.createElement("style");return n.type="text/css",n.textContent=".opal-input-mask-definition{display:none}",e.appendChild(n),n}return null}(document)}})});
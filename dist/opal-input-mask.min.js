!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("rionite"),require("cellx")):"function"==typeof define&&define.amd?define(["rionite","cellx"],e):"object"==typeof exports?exports["opal-input-mask"]=e(require("rionite"),require("cellx")):t["opal-input-mask"]=e(t.rionite,t.cellx)}(this,function(t,e){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}({0:function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),r=this&&this.__decorate||function(t,e,i,n){var r,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var u=t.length-1;u>=0;u--)(r=t[u])&&(s=(o<3?r(s):o>3?r(e,i,s):r(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s},o=i(2),s=i(1),u=i(5),f=i(4),l=i(5);e.OpalInputMaskDefinition=l.default;var c=i(4);e.defaultDefinitions=c.default;var a=Array.prototype.forEach,p=/iphone/i.test(navigator.userAgent),h=_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.initialize=function(){this._definitions=Object.create(this.constructor.defaultDefinitions)},e.prototype.ready=function(){this._textField=this.$("text-input").$("text-field");var t=this._definitions;a.call(this.element.querySelectorAll("opal-input-mask-definition"),function(e){var i=e.$c.props;t[i.maskChar]=i.regex}),o.define(this,{_mask:function(){return this.props.mask.split("").filter(function(t){return"?"!=t})},_partialIndex:function(){var t=this.props.mask,e=t.indexOf("?");return e==-1?t.length:e},_tests:function(){return this._mask.map(function(e){return t[e]||null})},_firstTestIndex:function(){return this._tests.findIndex(function(t){return t})}}),this._initBuffer()},e.prototype.elementAttached=function(){this.listenTo(this,"change:_mask",this._onMaskChange),this.listenTo(this._textField,{focusin:this._onTextFieldFocusIn,focusout:this._onTextFieldFocusOut,keydown:this._onTextFieldKeyDown,keypress:this._onTextFieldKeyPress,input:this._onTextFieldInput}),this._checkValue(!1)},e.prototype._onMaskChange=function(){var t=this;this._initBuffer(),setTimeout(function(){t._checkValue(!1)},1)},e.prototype._onTextFieldFocusIn=function(){var t=this;this._focusText=this._textField.value;var e=this._checkValue(!1);this._writeBuffer(),setTimeout(function(){e==t._buffer.length?t._setTextFieldSelection(0,e):t._setTextFieldSelection(e)},1)},e.prototype._onTextFieldFocusOut=function(){this._checkValue(!1),this._textField.value!=this._focusText&&this.$("text-input").emit("change")},e.prototype._onTextFieldKeyDown=function(t){var e=this._textField,i=t.which;if(8==i||46==i||p&&127==i){t.preventDefault();var n=e.selectionStart,r=e.selectionEnd;n==r&&(46==i?(n=this._nextTestIndex(n-1),r=this._nextTestIndex(n)):n=this._prevTestIndex(n));var o=e.value;if(this._clearBuffer(n,r),this._shiftLeft(n,r-1),o!=e.value){var s=this.$("text-input");s.constructor.events["text-field"].input.call(s,t)}}else if(27==i&&(t.preventDefault(),e.value!=this._focusText)){e.value=this._focusText,this._setTextFieldSelection(0,this._checkValue(!1));var s=this.$("text-input");s.constructor.events["text-field"].input.call(s,t)}},e.prototype._onTextFieldKeyPress=function(t){var e=this._tests,i=this._buffer.length,n=this._textField,r=n.selectionStart,o=n.selectionEnd,s=t.which;if(!(t.ctrlKey||t.altKey||t.metaKey||s<32)&&s){t.preventDefault(),r!=o&&(this._clearBuffer(r,o),this._shiftLeft(r,o-1));var u=this._nextTestIndex(r-1);if(u<i){var f=String.fromCharCode(s);if(e[u].test(f)){this._shiftRight(u),this._buffer[u]=f,this._writeBuffer(),u=this._nextTestIndex(u),this._setTextFieldSelection(u,u);var l=this.$("text-input");l.constructor.events["text-field"].input.call(l,t),u>=i&&this.emit("complete")}else if(r!=o){var l=this.$("text-input");l.constructor.events["text-field"].input.call(l,t)}}}},e.prototype._onTextFieldInput=function(){var t=this;setTimeout(function(){t._setTextFieldSelection(t._checkValue(!0))},1)},e.prototype._initBuffer=function(){var t=this._definitions;this._buffer=this._mask.map(function(e){return t[e]?null:e})},e.prototype._checkValue=function(t){for(var e=this._partialIndex,i=this._tests,n=this._buffer,r=n.length,o=this._textField,s=o.value,u=s.length,f=0,l=-1,c=0;f<r;f++)if(i[f]){for(n[f]=null;c++<u;){var a=s.charAt(c-1);if(i[f].test(a)){n[f]=a,l=f;break}}if(c>u){this._clearBuffer(f+1,r);break}}else n[f]==s.charAt(c)&&c++,f<e&&(l=f);return t?this._writeBuffer():l+1<e?(o.value="",this._clearBuffer(0,r)):o.value=n.slice(0,l+1).join(""),e?f:this._firstTestIndex},e.prototype._shiftLeft=function(t,e){if(!(t<0)){for(var i=this._tests,n=this._buffer,r=t,o=this._nextTestIndex(e),s=n.length;r<s;r++){var u=i[r];if(u){var f=void 0;if(!(o<s&&(f=n[o])&&u.test(f)))break;n[r]=f,n[o]=null,o=this._nextTestIndex(o)}}this._writeBuffer(),this._setTextFieldSelection(Math.max(this._firstTestIndex,t))}},e.prototype._shiftRight=function(t){for(var e=this._tests,i=this._buffer,n=null,r=i.length;t<r;t++)if(e[t]){var o=i[t];i[t]=n;var s=this._nextTestIndex(t);if(!(s<r&&o&&e[s].test(o)))break;n=o}},e.prototype._nextTestIndex=function(t){for(var e=this._tests,i=e.length;++t<i&&!e[t];);return t},e.prototype._prevTestIndex=function(t){for(var e=this._tests;--t>=0&&!e[t];);return t},e.prototype._writeBuffer=function(){var t=this._buffer,e=t.indexOf(null);this._textField.value=(e==-1?t:t.slice(0,e)).join("")},e.prototype._clearBuffer=function(t,e){var i=this._tests,n=this._buffer;e>n.length&&(e=n.length);for(var r=t;r<e;r++)i[r]&&(n[r]=null)},e.prototype._setTextFieldSelection=function(t,e){void 0===e&&(e=t),this._textField.setSelectionRange(t,e)},e}(s.Component);h.OpalInputMaskDefinition=u.default,h.defaultDefinitions=f.default,h=_=r([s.d.Component({elementIs:"opal-input-mask",props:{mask:{type:String,required:!0}},bemlTemplate:"rt-content/content (cloning=no)"})],h),Object.defineProperty(e,"__esModule",{value:!0}),e.default=h;var _},1:function(e,i){e.exports=t},2:function(t,i){t.exports=e},4:function(t,e){"use strict";var i=Object.create(null);i[9]=/\d/,i.z=/[a-zA-Z]/,i["*"]=/[0-9a-zA-Z]/,Object.defineProperty(e,"__esModule",{value:!0}),e.default=i},5:function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),r=this&&this.__decorate||function(t,e,i,n){var r,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var u=t.length-1;u>=0;u--)(r=t[u])&&(s=(o<3?r(s):o>3?r(e,i,s):r(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s};i(53);var o=i(1),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(o.Component);s=r([o.d.Component({elementIs:"opal-input-mask-definition",props:{maskChar:{type:String,required:!0,readonly:!0},regex:{type:Object,required:!0,readonly:!0}}})],s),Object.defineProperty(e,"__esModule",{value:!0}),e.default=s},53:function(t,e){t.exports=function(t){var e=t.head||t.getElementsByTagName("head")[0];if(e){var i=t.createElement("style");return i.type="text/css",i.textContent=".opal-input-mask-definition{display:none}",e.appendChild(i),i}return null}(document)}})});
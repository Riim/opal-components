!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("rionite"),require("cellx")):"function"==typeof define&&define.amd?define(["rionite","cellx"],e):"object"==typeof exports?exports["opal-autosuggestion"]=e(require("rionite"),require("cellx")):t["opal-autosuggestion"]=e(t.rionite,t.cellx)}(this,function(t,e){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}({0:function(t,e,n){"use strict";function i(t){return t.trim().replace(/\s+/g," ").toLowerCase()}var o=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},s=this&&this.__decorate||function(t,e,n,i){var o,s=arguments.length,l=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,i);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(l=(s<3?o(l):s>3?o(e,n,l):o(e,n))||l);return s>3&&l&&Object.defineProperty(e,n,l),l};n(44);var l=n(2),u=n(1),a=n(22),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._inputAfterSelecting=!1,e}return o(e,t),e.prototype.initialize=function(){this.dataProvider=Function("return this."+this.props.dataprovider+";").call(this.ownerComponent||window),l.define(this,{list:new l.ObservableList,_loadingPlanned:!1,loading:!1,loaderShown:function(){return this._loadingPlanned||this.loading},selectedItem:this.props.selectedItem})},e.prototype.ready=function(){this._listItems=this.$("list").getElementsByClassName("opal-autosuggestion__list-item")},e.prototype.elementAttached=function(){this.listenTo(this.$("input").$("text-field"),"click",this._onTextFieldClick),this.listenTo(this.$("menu"),"property-opened-change",this._onMenuOpenedChange),this.listenTo(this.list,"change",this._onListChange),this.listenTo(this,"change:loaderShown",this._onLoaderShownChange)},e.prototype.propertyChanged=function(t,e){"selectedItem"==t&&(this.selectedItem=e,this.$("input").value=e?e.text:"")},e.prototype._onTextFieldClick=function(){this.openMenu()},e.prototype._onMenuOpenedChange=function(t){t.target==this.$("menu")&&(t.value?(this._documentFocusInListening=this.listenTo(document,"focusin",this._onDocumentFocusIn),this._documentKeyDownListening=this.listenTo(document,"keydown",this._onDocumentKeyDown),this._documentMouseUpListening=this.listenTo(document,"mouseup",this._onDocumentMouseUp)):(this._documentFocusInListening.stop(),this._documentKeyDownListening.stop(),this._documentMouseUpListening.stop()))},e.prototype._onListChange=function(){this.openMenu()},e.prototype._onLoaderShownChange=function(t){this.$("input").props.loading=t.value},e.prototype._onDocumentFocusIn=function(){document.activeElement==document.body||this.element.contains(document.activeElement.parentNode)||(this.closeMenu(),this._setSelectedItemOfList())},e.prototype._onDocumentKeyDown=function(t){switch(t.which){case 38:case 40:t.preventDefault();var e=this._focusedListItem;if(e){var n=this._focusedListItem[38==t.which?"previousElementSibling":"nextElementSibling"];n&&"TEMPLATE"!=n.tagName&&(this._focusedListItem.removeAttribute("focused"),this._focusedListItem=n,n.setAttribute("focused",""))}break;case 13:case 39:t.preventDefault();var e=this._focusedListItem;if(e){var i=e.dataset;this.$("input").value=i.text,this.closeMenu(),this._setSelectedItem({value:i.value,text:i.text})}break;case 27:t.preventDefault(),this.closeMenu(),this._setSelectedItemOfList()}},e.prototype._onDocumentMouseUp=function(){var t=this;setTimeout(function(){document.activeElement!=t.$("input").$("text-field")&&(t.closeMenu(),t._setSelectedItemOfList())},1)},e.prototype._onListItemClick=function(t,e){var n=this.$("input"),i=e.dataset;n.value=i.text,n.focus(),this.closeMenu(),this._setSelectedItem({value:i.value,text:i.text})},e.prototype._load=function(){this.loading=!0;var t=this.dataProvider,e=[this.$("input").value];t.getItems.length>=2&&e.unshift(this.props.count),t.getItems.apply(t,e).then(this._requestCallback=this.registerCallback(function(t){var e=this;this.loading=!1;var n=t.items;n.length&&(this.list.addRange(n),l.Cell.afterRelease(function(){var t=e._focusedListItem=e._listItems[0];t.setAttribute("focused","")}))}))},e.prototype._cancelLoading=function(){this._loadingPlanned?(this._loadingPlanned=!1,this._loadingTimeout.clear()):this.loading&&(this._requestCallback.cancel(),this.loading=!1)},e.prototype.openMenu=function(){this.list.length&&this.$("menu").open()},e.prototype.closeMenu=function(){this.$("menu").close()},e.prototype._setSelectedItemOfList=function(){if(this._inputAfterSelecting){var t=i(this.$("input").value);this._setSelectedItem(this.list.find(function(e){return i(e.text)==t})||null)}},e.prototype._setSelectedItem=function(t){(t?!this.selectedItem||this.selectedItem.value!=t.value:this.selectedItem)&&(this._inputAfterSelecting=!1,this.selectedItem=t,this.emit("change"))},e.prototype.clear=function(){this.selectedItem&&(this.selectedItem=null),this.$("input").clear()},e}(u.Component);c=s([u.d.Component({elementIs:"opal-autosuggestion",props:{dataprovider:{type:String,required:!0,readonly:!0},selectedItem:Object,minQueryLength:3,count:5},i18n:{inputPlaceholder:u.getText.t("начните вводить для поиска")},bemlTemplate:a,events:{input:{focusin:function(){this.openMenu()},focusout:function(){this._cancelLoading(),this.$("menu").props.opened||this._setSelectedItemOfList()},input:function(t){var e=this;this._inputAfterSelecting=!0,this.closeMenu(),this._cancelLoading(),this.list.clear(),t.target.value.length>=this.props.minQueryLength&&(this._loadingPlanned=!0,this._loadingTimeout=this.setTimeout(function(){e._loadingPlanned=!1,e._load()},300))}}}})],c),Object.defineProperty(e,"__esModule",{value:!0}),e.default=c},1:function(e,n){e.exports=t},2:function(t,n){t.exports=e},22:function(t,e){t.exports="rt-content (select=.opal-autosuggestion__input, cloning=no) {\nopal-text-input/input (\nvalue={props.selectedItem.text},\nplaceholder={constructor.i18n.inputPlaceholder},\nloading={loaderShown}\n)\n}\nopal-dropdown/menu {\ndiv/list {\ntemplate (is=rt-repeat, for=item of list, strip, rt-silent) {\ndiv/list-item (data-value={item.value}, data-text={item.text}, rt-click=_onListItemClick) {\n'{item.text}'\n}\n}\n}\n}"},44:function(t,e){t.exports=function(t){var e=t.head||t.getElementsByTagName("head")[0];if(e){var n=t.createElement("style");return n.type="text/css",n.textContent=".opal-autosuggestion{position:relative;display:inline-block;vertical-align:middle;line-height:0}.opal-autosuggestion .opal-autosuggestion__input{display:block}.opal-autosuggestion .opal-autosuggestion__list-item{position:relative;padding:7px 22px;background:#fff;color:#000;text-align:left;text-shadow:none;white-space:nowrap;font:16px/24px Verdana,Geneva,sans-serif;font-weight:400;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}.opal-autosuggestion .opal-autosuggestion__list-item:hover,.opal-autosuggestion .opal-autosuggestion__list-item[focused]{background:#e6e6e6}.opal-autosuggestion .opal-autosuggestion__list-item:active{background:#ccc}.opal-input-validator .opal-autosuggestion{display:block}",e.appendChild(n),n}return null}(document)}})});
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("rionite"),require("cellx")):"function"==typeof define&&define.amd?define(["rionite","cellx"],e):"object"==typeof exports?exports["opal-autosuggestion"]=e(require("rionite"),require("cellx")):t["opal-autosuggestion"]=e(t.rionite,t.cellx)}(this,function(t,e){return function(t){function e(s){if(n[s])return n[s].exports;var i=n[s]={exports:{},id:s,loaded:!1};return t[s].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}({0:function(t,e,n){"use strict";n(75);var s=n(2),i=s.Cell,o=s.cellx,a=n(1),u=a.Component,l=a.getText,c=a.template;t.exports=u.extend("opal-autosuggestion",{Static:{props:{dataprovider:String,minLength:3},i18n:{inputPlaceholder:l.t("начните вводить для поиска")},template:c(n(74)),assets:{input:{"on-focusin":function(){this.openMenu()},"on-input":function(t){var e=this;this.closeMenu();var n=t.target.value.length>=this.props.minLength;this._loadingPlanned?this._loadingTimeout.clear():(this.loading&&(this._requestCallback.cancel(),this.loading=!1),this.list.clear(),n&&(this._loadingPlanned=!0)),n&&(this._loadingTimeout=this.setTimeout(function(){e._loadingPlanned=!1,e._load()},300))}},menu:{},list:{}}},_loadingTimeout:null,_requestCallback:null,_listItems:null,_focusedListItem:null,initialize:function(){this.dataprovider=(this.ownerComponent||window)[this.props.dataprovider],o.define(this,{list:o.list(),_loadingPlanned:!1,loading:!1,loaderShown:function(){return this._loadingPlanned||this.loading}})},ready:function(){this._listItems=this.assets.list.getElementsByClassName("opal-autosuggestion__list-item")},elementAttached:function(){this.listenTo(this.list,"change",this._onListChange),this.listenTo(this.assets.input.assets.input,"click",this._onInputClick),this.listenTo(this.assets.menu.props,"change:opened",this._onMenuOpenedChange)},_load:function(){var t=this;this.loading=!0,this.dataprovider.getItems(this.assets.input.value).then(this._requestCallback=this.registerCallback(function(e){t.loading=!1,e.items.length&&(t.list.addRange(e.items),i.afterRelease(function(){var e=t._focusedListItem=t._listItems[0];e.setAttribute("focused","")}))}))},_onListChange:function(){this.openMenu()},_onInputClick:function(){this.openMenu()},_onMenuOpenedChange:function(t){t.value[1]?(this._documentFocusInListening=this.listenTo(document,"focusin",this._onDocumentFocusIn),this._documentKeyDownListening=this.listenTo(document,"keydown",this._onDocumentKeyDown),this._documentMouseUpListening=this.listenTo(document,"mouseup",this._onDocumentMouseUp)):(this._documentFocusInListening.stop(),this._documentKeyDownListening.stop(),this._documentMouseUpListening.stop())},_onDocumentFocusIn:function(){document.activeElement!=this.assets.input.assets.input&&this.closeMenu()},_onDocumentKeyDown:function(t){switch(t.which){case 38:case 40:var e=this._focusedListItem;if(e){t.preventDefault();var n=this._focusedListItem[38==t.which?"previousElementSibling":"nextElementSibling"];n&&"TEMPLATE"!=n.tagName&&(this._focusedListItem.removeAttribute("focused"),this._focusedListItem=n,n.setAttribute("focused",""))}break;case 13:case 39:var s=this._focusedListItem;if(s){t.preventDefault();var i=this.assets.input;i.value=s.dataset.text,i.focus(),this.closeMenu()}break;case 27:t.preventDefault(),this.assets.input.focus(),this.closeMenu()}},_onDocumentMouseUp:function(){var t=this;setTimeout(function(){document.activeElement!=t.assets.input.assets.input&&t.closeMenu()},1)},_onListItemClick:function(t,e){var n=this.assets.input;n.value=e.dataset.text,n.focus(),this.closeMenu()},openMenu:function(){this.list.length&&this.assets.menu.open()},closeMenu:function(){this.assets.menu.close()}})},1:function(e,n){e.exports=t},2:function(t,n){t.exports=e},74:function(t,e){t.exports='<rt-content select=".opal-autosuggestion__input"> <opal-text-input class="opal-autosuggestion__input" placeholder="{{i18n.inputPlaceholder}}" loading="{loaderShown}"></opal-text-input> </rt-content> {{block menu }} <opal-dropdown class="opal-autosuggestion__menu"> {{block list }} <div class="opal-autosuggestion__list"> {{block list_inner }} <template is="rt-repeat" for="item of list" strip=""> <div class="opal-autosuggestion__list-item" data-id="{item.id}" data-text="{item.text}" rt-click="_onListItemClick">{item.text}</div> </template> {{/block}} </div> {{/block}} </opal-dropdown> {{/block}}'},75:function(t,e){t.exports=function(t){var e=t.head||t.getElementsByTagName("head")[0];if(e){var n=t.createElement("style");return n.type="text/css",n.textContent=".opal-autosuggestion{position:relative;display:inline-block}.opal-autosuggestion .opal-autosuggestion__list-item{position:relative;padding:7px 22px;background:#fff;color:#000;text-align:left;text-shadow:none;white-space:nowrap;font:16px/24px Verdana,Geneva,sans-serif;font-weight:400;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}.opal-autosuggestion .opal-autosuggestion__list-item:hover,.opal-autosuggestion .opal-autosuggestion__list-item[focused]{background:#e6e6e6}.opal-autosuggestion .opal-autosuggestion__list-item:active{background:#ccc}",e.appendChild(n),n}return null}(document)}})});
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("rionite"),require("cellx")):"function"==typeof define&&define.amd?define(["rionite","cellx"],e):"object"==typeof exports?exports["opal-autosuggestion"]=e(require("rionite"),require("cellx")):t["opal-autosuggestion"]=e(t.rionite,t.cellx)}(this,function(t,e){return function(t){function e(n){if(s[n])return s[n].exports;var i=s[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var s={};return e.m=t,e.c=s,e.p="",e(0)}({0:function(t,e,s){"use strict";function n(t){return t.trim().replace(/\s+/g," ").toLowerCase()}s(75);var i=s(2),o=i.Cell,a=i.cellx,l=s(1),u=l.getText,c=l.ComponentTemplate,r=l.Component;t.exports=r.extend("opal-autosuggestion",{Static:{props:{dataprovider:{type:String,required:!0,readonly:!0},minLength:3},i18n:{inputPlaceholder:u.t("начните вводить для поиска")},template:new c(s(74)),assets:{input:{"on-focusin":function(){this.openMenu()},"on-focusout":function(){this._cancelLoading(),this.assets.menu.props.opened||this._setSelectedItemOfList()},"on-input":function(t){var e=this;this.closeMenu(),this._cancelLoading(),this.list.clear(),t.target.value.length>=this.props.minLength&&(this._loadingPlanned=!0,this._loadingTimeout=this.setTimeout(function(){e._loadingPlanned=!1,e._load()},300))}},menu:{},list:{}}},_loadingTimeout:null,_requestCallback:null,_listItems:null,_focusedListItem:null,initialize:function(){this.dataprovider=(this.ownerComponent||window)[this.props.dataprovider],a.define(this,{list:a.list(),_loadingPlanned:!1,loading:!1,loaderShown:function(){return this._loadingPlanned||this.loading},selectedItem:null})},ready:function(){this._listItems=this.assets.list.getElementsByClassName("opal-autosuggestion__list-item")},elementAttached:function(){this.listenTo(this.assets.input.assets.input,"click",this._onInputClick),this.listenTo(this.assets.menu.props,"change:opened",this._onMenuOpenedChange),this.listenTo(this.list,"change",this._onListChange),this.listenTo(this,"change:loaderShown",this._onLoaderShownChange)},_load:function(){var t=this;this.loading=!0,this.dataprovider.getItems(this.assets.input.value).then(this._requestCallback=this.registerCallback(function(e){t.loading=!1;var s=e.items;s.length&&(t.list.addRange(s),o.afterRelease(function(){var e=t._focusedListItem=t._listItems[0];e.setAttribute("focused","")}))}))},_onInputClick:function(){this.openMenu()},_onMenuOpenedChange:function(t){t.value[1]?(this._documentFocusInListening=this.listenTo(document,"focusin",this._onDocumentFocusIn),this._documentKeyDownListening=this.listenTo(document,"keydown",this._onDocumentKeyDown),this._documentMouseUpListening=this.listenTo(document,"mouseup",this._onDocumentMouseUp)):(this._documentFocusInListening.stop(),this._documentKeyDownListening.stop(),this._documentMouseUpListening.stop())},_onListChange:function(){this.openMenu()},_onLoaderShownChange:function(t){this.assets.input.props.loading=t.value},_onDocumentFocusIn:function(){document.activeElement!=this.assets.input.assets.input&&(this.closeMenu(),this._setSelectedItemOfList())},_onDocumentKeyDown:function(t){switch(t.which){case 38:case 40:var e=this._focusedListItem;if(e){t.preventDefault();var s=this._focusedListItem[38==t.which?"previousElementSibling":"nextElementSibling"];s&&"TEMPLATE"!=s.tagName&&(this._focusedListItem.removeAttribute("focused"),this._focusedListItem=s,s.setAttribute("focused",""))}break;case 13:case 39:var n=this._focusedListItem;if(n){t.preventDefault();var i=this.assets.input,o=n.dataset;i.value=o.text,this.closeMenu(),this._setSelectedItem({value:o.value,text:o.text})}break;case 27:t.preventDefault(),this.closeMenu(),this._setSelectedItemOfList()}},_onDocumentMouseUp:function(){var t=this;setTimeout(function(){document.activeElement!=t.assets.input.assets.input&&(t.closeMenu(),t._setSelectedItemOfList())},1)},_onListItemClick:function(t,e){var s=this.assets.input,n=e.dataset;s.value=n.text,s.focus(),this.closeMenu(),this._setSelectedItem({value:n.value,text:n.text})},openMenu:function(){this.list.length&&this.assets.menu.open()},closeMenu:function(){this.assets.menu.close()},_cancelLoading:function(){this._loadingPlanned?(this._loadingPlanned=!1,this._loadingTimeout.clear()):this.loading&&(this._requestCallback.cancel(),this.loading=!1)},_setSelectedItemOfList:function(){var t=n(this.assets.input.value);this._setSelectedItem(this.list.find(function(e){return n(e.text)==t})||null)},_setSelectedItem:function(t){(t?!this.selectedItem||this.selectedItem.value!=t.value:this.selectedItem)&&(this.selectedItem=t,this.emit("change"))}})},1:function(e,s){e.exports=t},2:function(t,s){t.exports=e},74:function(t,e){t.exports='<rt-content select=".opal-autosuggestion__input"> {{block input }} <opal-text-input class="opal-autosuggestion__input" placeholder="{{i18n.inputPlaceholder}}"></opal-text-input> {{/block}} </rt-content> {{block menu }} <opal-dropdown class="opal-autosuggestion__menu"> {{block list }} <div class="opal-autosuggestion__list"> {{block list_inner }} <template is="rt-repeat" for="item of list" strip="" rt-silent=""> <div class="opal-autosuggestion__list-item" data-value="{item.value}" data-text="{item.text}" rt-click="_onListItemClick">{item.text}</div> </template> {{/block}} </div> {{/block}} </opal-dropdown> {{/block}}'},75:function(t,e){t.exports=function(t){var e=t.head||t.getElementsByTagName("head")[0];if(e){var s=t.createElement("style");return s.type="text/css",s.textContent=".opal-autosuggestion{position:relative;display:inline-block}.opal-autosuggestion .opal-autosuggestion__list-item{position:relative;padding:7px 22px;background:#fff;color:#000;text-align:left;text-shadow:none;white-space:nowrap;font:16px/24px Verdana,Geneva,sans-serif;font-weight:400;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}.opal-autosuggestion .opal-autosuggestion__list-item:hover,.opal-autosuggestion .opal-autosuggestion__list-item[focused]{background:#e6e6e6}.opal-autosuggestion .opal-autosuggestion__list-item:active{background:#ccc}",e.appendChild(s),s}return null}(document)}})});
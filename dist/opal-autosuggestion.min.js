!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("rionite"),require("cellx")):"function"==typeof define&&define.amd?define(["rionite","cellx"],e):"object"==typeof exports?exports["opal-autosuggestion"]=e(require("rionite"),require("cellx")):t["opal-autosuggestion"]=e(t.rionite,t.cellx)}(this,function(t,e){return function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return t[o].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}({0:function(t,e,n){"use strict";function o(t){return t.trim().replace(/\s+/g," ").toLowerCase()}var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=this&&this.__decorate||function(t,e,n,o){var i,s=arguments.length,a=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(e,"__esModule",{value:!0}),n(43);var a=n(2),l=n(1),u=n(22),r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._isInputLast=!1,e}return i(e,t),e.prototype.initialize=function(){this.dataProvider=Function("return this."+this.props.dataprovider+";").call(this.ownerComponent||window),a.define(this,{list:new a.ObservableList,_loadingPlanned:!1,loading:!1,loaderShown:function(){return this._loadingPlanned||this.loading},selectedItem:this.props.selectedItem})},e.prototype.elementAttached=function(){this.listenTo(this.$("text-input").$("text-field"),"click",this._onTextFieldClick),this.listenTo(this.$("menu").element,"mouseover",this._onMenuMouseOver),this.listenTo(this.list,"change",this._onListChange),this.listenTo(this,"change:loaderShown",this._onLoaderShownChange)},e.prototype.propertyChanged=function(t,e){"selectedItem"==t&&(this._clearList(),this.selectedItem=e,this.$("text-input").value=e?e.text:"")},e.prototype._onTextFieldClick=function(){this.openMenu()},e.prototype._onMenuMouseOver=function(t){for(var e=this.$("menu").element,n=t.target;!n.classList.contains("opal-autosuggestion__list-item");n=n.parentNode)if(n==e)return;var o=this._focusedListItem;n!=o&&(this._focusedListItem=n,o.removeAttribute("focused"),n.setAttribute("focused",""))},e.prototype._onListChange=function(){this.openMenu()},e.prototype._onLoaderShownChange=function(t){this.$("text-input").props.loading=t.value},e.prototype._onDocumentFocus=function(t){this.element.contains(t.target.parentNode)||(this.closeMenu(),this._setSelectedItemOfList())},e.prototype._onDocumentKeyDown=function(t){switch(t.which){case 38:case 40:t.preventDefault();var e=this._focusedListItem;if(e){var n=this.$$("list-item"),o=n.indexOf(e);if(38==t.which?o>0:o<n.length-1){var i=n[o+(38==t.which?-1:1)];this._focusedListItem=i,e.removeAttribute("focused"),i.setAttribute("focused","")}}break;case 13:case 39:t.preventDefault();var e=this._focusedListItem;if(e){var s=e.dataset;this.$("text-input").value=s.text,this.closeMenu(),this._setSelectedItem({value:s.value,text:s.text})}break;case 27:t.preventDefault(),this.closeMenu(),this._setSelectedItemOfList()}},e.prototype._onDocumentClick=function(t){this.element.contains(t.target)||(this.closeMenu(),this._setSelectedItemOfList())},e.prototype._onListItemClick=function(t,e){var n=this.$("text-input"),o=e.dataset;n.value=o.text,n.focus(),this.closeMenu(),this._setSelectedItem({value:o.value,text:o.text})},e.prototype._load=function(){this.loading=!0;var t=this.dataProvider,e=[this.$("text-input").value];t.getItems.length>=2&&e.unshift(this.props.count),t.getItems.apply(t,e).then(this._requestCallback=this.registerCallback(this._itemsRequestCallback))},e.prototype._itemsRequestCallback=function(t){var e=this;this.loading=!1;var n=t.items;n.length?(this.list.addRange(n),a.Cell.afterRelease(function(){var t=e.$("list-item");e._focusedListItem=t,t.setAttribute("focused","")})):this.props.showNotFound&&this.openMenu(!0)},e.prototype._cancelLoading=function(){this._loadingPlanned?(this._loadingPlanned=!1,this._loadingTimeout.clear()):this.loading&&(this._requestCallback.cancel(),this.loading=!1)},e.prototype.openMenu=function(t){return(t||this.list.length)&&this.$("menu").open(),this},e.prototype.closeMenu=function(){return this.$("menu").close(),this},e.prototype._setSelectedItemOfList=function(){if(this._isInputLast){var t=o(this.$("text-input").value);this._setSelectedItem(this.list.find(function(e){return o(e.text)==t})||null)}},e.prototype._setSelectedItem=function(t){if(t){if(this._isInputLast=!1,this._clearList(),this.selectedItem&&this.selectedItem.value==t.value)return}else if(!this.selectedItem)return;this.selectedItem=t,this.emit("change")},e.prototype.clear=function(){this._clearList(),this.selectedItem&&(this.selectedItem=null),this.$("text-input").clear()},e.prototype._clearList=function(){this.closeMenu(),this._cancelLoading(),this.list.clear(),this._focusedListItem=null},e}(l.Component);r=s([l.d.Component({elementIs:"opal-autosuggestion",props:{dataprovider:{type:String,required:!0,readonly:!0},selectedItem:eval,minQueryLength:3,count:5,showNotFound:!1},i18n:{inputPlaceholder:l.getText.t("начните вводить для поиска"),notFound:l.getText.t("Ничего не найдено")},bemlTemplate:u,events:{"text-input":{focus:function(){this.openMenu()},blur:function(){this._cancelLoading(),this.$("menu").props.opened||this._setSelectedItemOfList()},input:function(t){var e=this;this._isInputLast=!0,this._clearList(),t.target.value.length>=this.props.minQueryLength&&(this._loadingPlanned=!0,this._loadingTimeout=this.setTimeout(function(){e._loadingPlanned=!1,e._load()},300))},change:function(t){t.target.value.length||(this._clearList(),this.selectedItem&&(this.selectedItem=null,this.emit("change")))}},menu:{"property-opened-change":function(t){t.value?(this._documentFocusListening=this.listenTo(document,"focus",this._onDocumentFocus,this,!0),this._documentKeyDownListening=this.listenTo(document,"keydown",this._onDocumentKeyDown),this._documentClickListening=this.listenTo(document,"click",this._onDocumentClick)):(this._documentFocusListening.stop(),this._documentKeyDownListening.stop(),this._documentClickListening.stop())}}}})],r),e.default=r},1:function(e,n){e.exports=t},2:function(t,n){t.exports=e},22:function(t,e){t.exports="rt-content (select=.opal-autosuggestion__text-input, cloning=no) {\nopal-text-input/text-input (\nvalue={props.selectedItem.text},\nplaceholder={constructor.i18n.inputPlaceholder},\nloading={loaderShown}\n)\n}\nopal-dropdown/menu {\ndiv/list {\ntemplate (is=rt-repeat, for=item of list, rt-silent) {\ndiv/list-item (data-value={item.value}, data-text={item.text}, rt-click=_onListItemClick) {\n'{item.text}'\n}\n}\n}\nspan/not-found-message (shown={list.length |not }) { '{constructor.i18n.notFound}' }\n}"},43:function(t,e){t.exports=function(t){var e=t.head||t.getElementsByTagName("head")[0];if(e){var n=t.createElement("style");return n.type="text/css",n.textContent=".opal-autosuggestion{position:relative;display:inline-block;vertical-align:middle}.opal-autosuggestion .opal-autosuggestion__text-input{display:block}.opal-autosuggestion .opal-autosuggestion__list-item{position:relative;padding:7px 22px;background:#fff;color:#000;text-align:left;text-shadow:none;white-space:nowrap;font:16px/24px Verdana,Geneva,sans-serif;font-weight:400;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}.opal-autosuggestion .opal-autosuggestion__list-item:hover,.opal-autosuggestion .opal-autosuggestion__list-item[focused]{background:#e6e6e6}.opal-autosuggestion .opal-autosuggestion__list-item:active{background:#ccc}.opal-autosuggestion .opal-autosuggestion__not-found-message{display:none;padding:10px;text-align:center;white-space:nowrap;opacity:.6}.opal-autosuggestion .opal-autosuggestion__not-found-message[shown]{display:block}.opal-input-validator .opal-autosuggestion{display:block}",e.appendChild(n),n}return null}(document)}})});
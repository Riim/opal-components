!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("rionite"),require("cellx")):"function"==typeof define&&define.amd?define(["rionite","cellx"],e):"object"==typeof exports?exports["opal-autosuggestion"]=e(require("rionite"),require("cellx")):t["opal-autosuggestion"]=e(t.rionite,t.cellx)}(this,function(t,e){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}({0:function(t,e,n){"use strict";function i(t){return t.trim().replace(/\s+/g," ").toLowerCase()}n(45);var o=n(2),s=o.Cell,l=o.cellx,a=n(1),u=a.getText,c=a.ComponentTemplate,r=a.Component;t.exports=r.extend("opal-autosuggestion",{Static:{props:{dataprovider:{type:String,required:!0,readonly:!0},selectedItem:Object,minQueryLength:3,count:5},i18n:{inputPlaceholder:u.t("начните вводить для поиска")},template:new c(n(22)),events:{input:{focusin:function(){this.openMenu()},focusout:function(){this._cancelLoading(),this.$("menu").props.opened||this._setSelectedItemOfList()},input:function(t){var e=this;this._wasInputAfterSelecting=!0,this.closeMenu(),this._cancelLoading(),this.list.clear(),t.target.value.length>=this.props.minQueryLength&&(this._loadingPlanned=!0,this._loadingTimeout=this.setTimeout(function(){e._loadingPlanned=!1,e._load()},300))}}}},_wasInputAfterSelecting:!1,_loadingTimeout:null,_requestCallback:null,_listItems:null,_focusedListItem:null,initialize:function(){this.dataProvider=Function("return this."+this.props.dataprovider+";").call(this.ownerComponent||window),l.define(this,{list:l.list(),_loadingPlanned:!1,loading:!1,loaderShown:function(){return this._loadingPlanned||this.loading},selectedItem:this.props.selectedItem})},ready:function(){this._listItems=this.$("list").getElementsByClassName("opal-autosuggestion__list-item")},elementAttached:function(){this.listenTo(this.$("input").$("input"),"click",this._onInputClick),this.listenTo(this.$("menu").props,"change:opened",this._onMenuOpenedChange),this.listenTo(this.list,"change",this._onListChange),this.listenTo(this,"change:loaderShown",this._onLoaderShownChange)},elementAttributeChanged:function(t,e,n){"selected-item"==t&&(this.selectedItem=n,this.$("input").value=n?n.text:"")},_load:function(){var t=this;this.loading=!0;var e=this.dataProvider,n=[this.$("input").value];e.getItems.length>=2&&n.unshift(this.props.count),e.getItems.apply(e,n).then(this._requestCallback=this.registerCallback(function(e){t.loading=!1;var n=e.items;n.length&&(t.list.addRange(n),s.afterRelease(function(){var e=t._focusedListItem=t._listItems[0];e.setAttribute("focused","")}))}))},_onInputClick:function(){this.openMenu()},_onMenuOpenedChange:function(t){t.value?(this._documentFocusInListening=this.listenTo(document,"focusin",this._onDocumentFocusIn),this._documentKeyDownListening=this.listenTo(document,"keydown",this._onDocumentKeyDown),this._documentMouseUpListening=this.listenTo(document,"mouseup",this._onDocumentMouseUp)):(this._documentFocusInListening.stop(),this._documentKeyDownListening.stop(),this._documentMouseUpListening.stop())},_onListChange:function(){this.openMenu()},_onLoaderShownChange:function(t){this.$("input").props.loading=t.value},_onDocumentFocusIn:function(){document.activeElement==document.body||this.element.contains(document.activeElement.parentNode)||(this.closeMenu(),this._setSelectedItemOfList())},_onDocumentKeyDown:function(t){switch(t.which){case 38:case 40:var e=this._focusedListItem;if(e){t.preventDefault();var n=this._focusedListItem[38==t.which?"previousElementSibling":"nextElementSibling"];n&&"TEMPLATE"!=n.tagName&&(this._focusedListItem.removeAttribute("focused"),this._focusedListItem=n,n.setAttribute("focused",""))}break;case 13:case 39:var i=this._focusedListItem;if(i){t.preventDefault();var o=i.dataset;this.$("input").value=o.text,this.closeMenu(),this._setSelectedItem({value:o.value,text:o.text})}break;case 27:t.preventDefault(),this.closeMenu(),this._setSelectedItemOfList()}},_onDocumentMouseUp:function(){var t=this;setTimeout(function(){document.activeElement!=t.$("input").$("input")&&(t.closeMenu(),t._setSelectedItemOfList())},1)},_onListItemClick:function(t,e){var n=this.$("input"),i=e.dataset;n.value=i.text,n.focus(),this.closeMenu(),this._setSelectedItem({value:i.value,text:i.text})},openMenu:function(){this.list.length&&this.$("menu").open()},closeMenu:function(){this.$("menu").close()},_cancelLoading:function(){this._loadingPlanned?(this._loadingPlanned=!1,this._loadingTimeout.clear()):this.loading&&(this._requestCallback.cancel(),this.loading=!1)},_setSelectedItemOfList:function(){var t=this;this._wasInputAfterSelecting&&!function(){var e=i(t.$("input").value);t._setSelectedItem(t.list.find(function(t){return i(t.text)==e})||null)}()},_setSelectedItem:function(t){(t?!this.selectedItem||this.selectedItem.value!=t.value:this.selectedItem)&&(this._wasInputAfterSelecting=!1,this.selectedItem=t,this.emit("change"))}})},1:function(e,n){e.exports=t},2:function(t,n){t.exports=e},22:function(t,e){t.exports='<rt-content select=".opal-autosuggestion__input"> {{block input }} <opal-text-input class="opal-autosuggestion__input" value="{props.selectedItem?.text}" placeholder="{{i18n.inputPlaceholder}}" loading="{loaderShown}"></opal-text-input> {{/block}} </rt-content> {{block menu }} <opal-dropdown class="opal-autosuggestion__menu"> {{block list }} <div class="opal-autosuggestion__list"> {{block list_inner }} <template is="rt-repeat" for="item of list" strip="" rt-silent=""> <div class="opal-autosuggestion__list-item" data-value="{item.value}" data-text="{item.text}" rt-click="_onListItemClick">{item.text}</div> </template> {{/block}} </div> {{/block}} </opal-dropdown> {{/block}}'},45:function(t,e){t.exports=function(t){var e=t.head||t.getElementsByTagName("head")[0];if(e){var n=t.createElement("style");return n.type="text/css",n.textContent=".opal-autosuggestion{position:relative;display:inline-block;vertical-align:middle;line-height:0}.opal-autosuggestion .opal-autosuggestion__input{display:block}.opal-autosuggestion .opal-autosuggestion__list-item{position:relative;padding:7px 22px;background:#fff;color:#000;text-align:left;text-shadow:none;white-space:nowrap;font:16px/24px Verdana,Geneva,sans-serif;font-weight:400;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}.opal-autosuggestion .opal-autosuggestion__list-item:hover,.opal-autosuggestion .opal-autosuggestion__list-item[focused]{background:#e6e6e6}.opal-autosuggestion .opal-autosuggestion__list-item:active{background:#ccc}.opal-input-validator .opal-autosuggestion{display:block}",e.appendChild(n),n}return null}(document)}})});